<!DOCTYPE html>
<html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta http-equiv="Content-Language" content="en-us">
<meta http-equiv="imagetoolbar" content="false">
<meta name="MSSmartTagsPreventParsing" content="true">
<title></title>
<link href="../../../css/bootstrap.min.css" rel="stylesheet" media="screen">
<style type="text/css">
  h1, h2, h3, h4, h5 {
    color: #006595;
  }
  .page-header {
    background: url("http://www.bluevia.com/img/fileteBottomHeaderUservoice.jpg") repeat-x scroll left bottom transparent;
    border: none;
    margin-top: 5px;
    margin-bottom: 20px;
  }
  .page-footer {
    background: url(http://www.bluevia.com/img/footerBG.gif) top left repeat-x;
    padding-top: 10px;
  }
  .page-footer h4 {
    color: #47C3D3;
    display: block;
    font-size: 19px;
    font-style: normal;
    font-weight: bold;
    letter-spacing: 1px;
    margin-bottom: 30px;
    text-transform: uppercase;
    text-decoration: none;
  }
  .page-footer li {
    border-bottom: #CCC 1px dotted;
  }
  .page-footer li a{
    font-style: italic;
    font-family: Georgia,"Times New Roman",Times,serif;
    list-style: none;
    display: list-item;
    line-height: 28px;
    font-size: 13px;
    color: #666;
    text-transform: lowercase;
    letter-spacing: normal;
    margin-bottom: 0;
    margin-left: 0;
  }
    .page-footer li a:hover{
      color: #000;
      text-decoration: none;
  }
  a {
    color: #47c3d3
  }
  a:hover {
    text-decoration: none;
    color: #006595;
  }
  #header .logo img {
    vertical-align: baseline;
  }
  #header .logo span {
    padding-bottom: 15px;
  }
  .accordion-toggle.inline {
    display: inline-block;
    background: #eee;
    margin-right: 10px;
  }
.accordion-toggle.inline:hover {
    background: #e6e6e6;
  }
.apidoc dd {
  display: table-row;
}
.apidoc li {
  list-style: none;
}
.apidoc .tab-pane > ul {
  margin-left: 0px;
}
.well.apimethodgroup {
  background: white;
}
.icon-chevron-down {
  cursor: pointer;
}
.bottomLinks {
  padding-bottom: 20px;
}
em {
  //background: #eef;
  color: #009;
  border-bottom: 1px #009 dotted;
}

  </style>
</head>
<body class="api" data-spy="scroll" data-target=".sidemenu">
  <script src="http://code.jquery.com/jquery-latest.js"></script><script src="../../../js/bootstrap.min.js"></script><div id="header-wrapper" class="page-header">
    <div id="header" class="container-fluid">
      <div class="row-fluid">
        <a class="logo offset1" href="../../../">
          <img src="http://bluevia.com/img/BlueVia-Hdr-Logo-SML.png" width="100" alt="Bluevia Logo"><span class="lightblue"></span>
        </a>

      </div>
    </div>
    <!-- #header --> </div>
  <!-- #header-wrapper -->

  <div class="container-fluid">
    <div class="row-fluid">
      <div class="content span8 offset1">

        <ul class="breadcrumb">
<li>
<a href="../../../">Home</a> <span class="divider">/</span>
</li>
          <li class="active">
        </ul>
<h1 id="adding-the-recording-of-participants-names-to-conferences">Adding The Recording Of Participants Names To Conferences</h1>

<p>There are four files for the demo which you can find in the Quick Start demo code from github  <strong>@todo: ADD LINK</strong>. </p>

<ol>
<li><em>pincodeConference.php</em></li>
  <li>
<em>eventHandler.php</em> and</li>
  <li>
<em>startConfernece.php</em> and an additional file</li>
  <li><em>recordingHandler.php</em></li>
</ol>
<p>This builds on top of the last <a href="../confwithpincode">pincode conference demo</a>.</p>

<p>The significant change for this demo can be found in the <em>startConfernece.php</em> code. In this case we are using the <a href="../../commandref/record"><em>record command</em></a> and the additional <em>conferenceProperies</em> element of <em>playOnEnter</em> this can be seen in either the moderator or participant code. Looking at the case for the moderator:</p>

<pre><code>case "moderator":
		$response = "{
			\"commands\": [
				{
					\"speak\": {
						\"text\": \"Please record your name, then press hash\",
						\"voice\": \"Female\"
					}
				},
				{
					\"record\": {
						\"finishOnKey\": \"#\",
						\"playBeep\": \"true\",
						\"export\": {
							\"url\": \"&lt;your-hostname-and-path&gt;/recordingHandler.php?msisdn=" . $callerId . "\"
						}
					}
				 },
</code></pre>

<p>The record command above specifies:</p>

<ul>
<li>to <em>playBeep</em> to start the recording</li>
  <li>to <em>finishOnKey</em> - #</li>
  <li>and then to export the recording to the PHP script specified. In this case you can see we are also passing in the MSISDN of the caller in the <em>$callerId</em> variable, which will be used by the script to save the recording of the participants name. The <em>$callerId</em> was retrieved prior to the code above on the line <em>$callerId = $obj-&gt;{‘callerId’};</em> It is an attribute of the <a href="../../notifications/">BlueVia call notification</a>. In the same way as you have previously retrieved the <em>$eventName</em> from the notification data, you can also retrieve the <em>$callerId</em>. In this case we are simply using this as an identifier to save the recording.</li>
  <li>within the export element you specify the location of the script that will handle your recording. In this case it is the script <em>recordingHandler.php</em> that you host in the same location as the other scripts in this example. As described above we are also passing in the <em>$callerId</em> of the caller as a URL parameter. The <em>recordingHandler.php</em> is discussed further below.</li>
</ul>
<p>Once you have recorded the callers name, you can then add them to the conference call, and specify to play the callers name when they enter the conference. This is done using the addition <em>conferenceProperties</em> element as seen below:</p>

<pre><code>\"dial\": {
	\"conferenceName\": \"" . $digitsLessHash . "\",
	\"conferenceProperties\": {
		\"playOnEnter\": {
			\"url\": \"&lt;your-hostname-and-path&gt;/" . $callerId . ".wav\"
			}
		}
	}
}

@todo add moderater cases to code muteOnEnter etc... and test!
@todo should be using the playOnEnter attribute in the conferenceProperties element, and not a play command prior to the conference. Do this and TEST!!
</code></pre>

<p>In the conferenceProperties element:</p>

<ul>
<li>
<em>playOnEnter</em> is used to specify the URL of the recorded caller name when they enter the conference. </li>
</ul>
<p>Finally looking at the <em>recordingHandler.php</em> script. This simply takes a HTTP POST request and save it to a file using the caller ID passed in as a URL parameter and a .wav file extension.</p>

<pre><code>&lt;?php

$msisdn = $_GET['msisdn'];
$myFile = $msisdn . ".wav";
$fh = fopen($myFile, 'w+')  or die("can't open file");
chmod($myFile,0777);

if (($stream = fopen('php://input', "r")) !== FALSE)
    fwrite($fh, (stream_get_contents($stream)));
fclose($fh);

?&gt;
</code></pre>

<p>So that’s the basics of inbound calling. Let’s have a look at <a href="../restapicreatecall">using the BlueVia Voice API</a> for outbound calls.</p>


        <hr>
<span id="prevPage" class="bottomLinks pull-left"></span>
        <span id="nextPage" class="bottomLinks pull-right"></span>

      </div>

      <div id="sidebar" class="span3">
        <div class="accordion" id="accordionMenu">
          <div class="accordion-group">
            <div class="accordion-heading">
              <a class="accordion-toggle inline" data-toggle="collapse" data-parent="#accordionOverview" href="#collapseOverview"><i class="icon-chevron-down"></i></a><a href="../../overview/">Overview</a>
            </div>
          <div id="collapseOverview" class="accordion-body collapse">
            <div class="accordion-inner">
              <ul class="js-guides nav nav-list sidemenu">
<li>
                  <a href="../../overview/restapi/">BlueVia Voice RESTful API</a>
                </li>
                <li>
                  <a href="../../overview/callcontrol/">BlueVia Voice Call Control Commands</a>
                </li>
                <li>
                  <a href="../../overview/callflows/">Call Flows</a>
                </li>
                <li>
                  <a href="../../overview/existing/">Existing BlueVia APIs and the BlueVia Voice API</a>
                </li>
                <li>
                  <a href="../../overview/balance/">Adding Balance To Your BlueVia Account</a>
                </li>
                <li>
                  <a href="../../overview/numbers/">Buying Numbers</a>
                </li>
                <li>
                  <a href="../../overview/configure/">Configuring Your BlueVia Numbers</a>
                </li>
                <li>
                  <a href="../../overview/usingnumbers/">Using Your BlueVia Voice Numbers</a>
                </li>
                <li>
                  <a href="../../overview/pricing/">BlueVia Voice API Costs</a>
                </li>
                <li>
                  <a href="../../overview/knownlimitations/">Known Alpha Limitations</a>
                </li>
              </ul>
</div>
          </div>

          </div>
          <div class="accordion-group">
            <div class="accordion-heading">
              <a class="accordion-toggle inline" data-toggle="collapse" data-parent="#accordionQuickstart" href="#collapseQuickstart"><i class="icon-chevron-down"></i></a><a href="../">Quick Start Guides</a>
            </div>
          <div id="collapseQuickstart" class="accordion-body collapse">
            <div class="accordion-inner">
              <ul class="nav nav-list">
<li>
                  <a href="../connectcallnocode/">Connect a Call Without Code</a>
                </li>
                <li>
                  <a href="../createconfnocode/">Create a Conference Without Code</a>
                </li>
                <li>
                  <a href="../confwithpincode/">A Conference With Pin Code</a>
                </li>
                <li>
                  <a href="./">Record Conference Participants Names</a>
                </li>
                <li>
                  <a href="../restapicreatecall/">Create A Call With the REST API</a>
                </li>
                <li>
                  <a href="../modifycall/">Modify An Existing Call</a>
                </li>
                <li>
                  <a href="../restapicreateconf/">Create A Conference Call With The REST API</a>
                </li>
                <li>
                  <a href="../restapiupdateconfig/">Update Your Number's Config With The REST API</a>
                </li>

              </ul>
</div>
          </div>
          </div>
          <div class="accordion-group">
            <div class="accordion-heading">
              <a class="accordion-toggle inline" data-toggle="collapse" data-parent="#accordionRestRef" href="#collapseRestRef"><i class="icon-chevron-down"></i></a><a href="../../restref/">RESTful API Reference</a>
            </div>
          <div id="collapseRestRef" class="accordion-body collapse">
            <div class="accordion-inner">
              <ul class="nav nav-list">
<li>
                  <a href="../../restref/request/">HTTP Request</a>
                </li>
                <li>
                  <a href="../../restref/response/">HTTP Response</a>
                </li>
                <li>
                  <a href="../../restref/resources/">Resources</a>
                </li>
                <li>
                  <a href="../../restref/accountresources/">Account Management Resources</a>
                </li>
                <li>
                  <a href="../../restref/account/">Account</a>
                </li>
                <li>
                  <a href="../../restref/accountnumberscollection/">Account Numbers Collection</a>
                </li>
                <li>
                  <a href="../../restref/accountnumber/">Account Number</a>
                </li>
                <li>
                  <a href="../../restref/accountconfigrulescollection/">Account Config Rules Collection</a>
                </li>
                <li>
                  <a href="../../restref/recordings/">Recordings</a>
                </li>
                <li>
                  <a href="../../restref/availablenumberscollection/">Available Numbers Collection</a>
                </li>
                <li>
                  <a href="../../restref/calls/">Calls Resources</a>
                </li>
                <li>
                  <a href="../../restref/callcollection/">Call Collection</a>
                </li>
                <li>
                  <a href="../../restref/call/">Call</a>
                </li>
                <li>
                  <a href="../../restref/calllegscollection/">Calls Leg Collection</a>
                </li>
                <li>
                  <a href="../../restref/callleg/">Call Leg</a>
                </li>
                <li>
                  <a href="../../restref/modifycall/">Modify Call - setcommands</a>
                </li>
                <li>
                  <a href="../../restref/sms/">SMS Resources</a>
                </li>
                <li>
                  <a href="../../restref/specificlegs/">Send Commands To Specific Legs</a>
                </li>
                <li>
                  <a href="../../restref/callstatuses/">Call Statuses</a>
                </li>
                <li>
                  <a href="../../restref/calllegstatuses/">Call Leg Statuses</a>
                </li>
              </ul>
</div>
          </div>
          </div>
          <div class="accordion-group">
            <div class="accordion-heading">
              <a class="accordion-toggle inline" data-toggle="collapse" data-parent="#accordionCommandRef" href="#collapseCommandRef"><i class="icon-chevron-down"></i></a><a href="../../commandref/">Call Control Commands Reference</a>
            </div>
          <div id="collapseCommandRef" class="accordion-body collapse">
            <div class="accordion-inner">
              <ul class="nav nav-list">
<li>
                  <a href="../../commandref/sendingcallcommands/">Providing Call Commands</a>
                </li>
                <li>
                  <a href="../../commandref/dial/">Dial</a>
                </li>
                <li>
                  <ul class="nav nav-list">
<li>
                      <a href="../../commandref/dialnumber/">Dial Number</a>
                    </li>
                    <li>
                      <a href="../../commandref/dialconference/">Dial Conference</a>
                    </li>
                    <li>
                      <a href="../../commandref/dialcallid/">Dial Call Id</a>
                    </li>
                  </ul>
</li>
                <li>
                  <a href="../../commandref/speak/">Speak</a>
                </li>
                <li>
                  <a href="../../commandref/play/">Play</a>
                </li>
                <li>
                  <a href="../../commandref/getdigits/">GetDigits</a>
                </li>
                <li>
                  <a href="../../commandref/record/">Record</a>
                </li>
                <li>
                  <a href="../../commandref/hangup/">HangUp</a>
                </li>
                <li>
                  <a href="../../commandref/redirect/">Redirect</a>
                </li>
                <li>
                  <a href="../../commandref/wait/">Wait</a>
                </li>
                <li>
                  <a href="../../commandref/sms/">SMS</a>
                </li>
                <li>
                  <a href="../../commandref/commandstospecificlegs/">Send Commands To Specific Legs</a>
                </li>
                <li>
                  <a href="../../commandref/commandchains/">Command Chains</a>
                </li>
              </ul>
</div>
          </div>
          </div>
          <div class="accordion-group">
            <div class="accordion-heading">
              <a class="accordion-toggle inline" data-toggle="collapse" data-parent="#accordionNotifications" href="#collapseNotifications"><i class="icon-chevron-down"></i></a><a href="../../notifications/">Notification Events Reference</a>
            </div>
          </div>
          <div class="accordion-group">
            <div class="accordion-heading">
              <a class="accordion-toggle inline" data-toggle="collapse" data-parent="#accordionErrorCodes" href="#collapseErrorCodes"><i class="icon-chevron-down"></i></a><a href="../../errorcodes/">Voice and SMS Error Codes</a>
            </div>
          <div id="collapseErrorCodes" class="accordion-body collapse">
            <div class="accordion-inner">
              <ul class="nav nav-list">
<li>
                  <a href="../../errorcodes/">Subsection</a>
                </li>
              </ul>
</div>
          </div>
          </div>
          <div class="accordion-group">
            <div class="accordion-heading">
              <a class="accordion-toggle inline" data-toggle="collapse" data-parent="#accordionRoadmap" href="#collapseRoadmap"><i class="icon-chevron-down"></i></a><a href="../../roadmap/">Roadmap</a>
            </div>
          </div>
          <div class="accordion-group">
            <div class="accordion-heading">
              <a class="accordion-toggle inline" data-toggle="collapse" data-parent="#accordionPlay" href="#collapsePlay"><i class="icon-chevron-down"></i></a><a href="../../play/">Play ...</a>
            </div>
          <div id="collapsePlay" class="accordion-body collapse">
            <div class="accordion-inner">
              <ul class="nav nav-list">
<li>
                  <a href="../../play/">BBC Newsreader</a>
                </li>
                <li>
                  <a href="../../play/panicbutton/">Rasberry Pi Panic Button</a>
                </li>
              </ul>
</div>
          </div>
          </div>
        </div>
      </div>
    </div>
  </div>
  <!-- /sidebar-module -->
<div class="page-footer">
  <div id="footer" class="container-fluid">
    <div class="row-fluid">
      <div class="footer_inner clearfix offset1">

        <ul class="footer_nav span2 unstyled">
<h4><a href="http://bluevia.com">Bluevia</a></h4>
          <li>
            <a href="https://bluevia.com/en/page/tour">Tour</a>
          </li>
          <li>
            <a href="http://bluevia.com/ot-www/webroot/index.php/en/page/boilerplate.TermsAndConds">terms and conditions</a>
          </li>
          <li>
            <a href="http://bluevia.com/ot-www/webroot/index.php/en/page/boilerplate.Privacy">privacy policy</a>
          </li>
          <li>
            <a href="http://bluevia.com/ot-www/webroot/index.php/en/page/boilerplate.Accessibility">accesibility</a>
          </li>
        </ul>
<ul class="footer_nav span2 unstyled">
<h4><a href="https://bluevia.com/en/page/tech">Tech Stuff</a></h4>
            <li>
                <a href="https://bluevia.com/en/page/tech.overview">Overview</a>
            </li>
            <li>
                <a href="https://bluevia.com/en/page/tech.howto">How To</a>
            </li>
            <li>
                <a href="https://bluevia.com/en/page/tech.APIs">APIs</a>
            </li>
            <li>
                <a href="https://bluevia.com/en/page/tech.libraries">Libraries</a>
            </li>
            <li>
                <a href="https://bluevia.com/en/page/tech.bluevialab">BlueVia Lab</a>
            </li>
            <li>
                <a href="https://bluevia.com/en/page/tech.arduino">Arduino</a>
            </li>
        </ul>
<ul class="footer_nav span2 unstyled">
<h4><a href="https://bluevia.com/en/page/biz">Biz Stuff</a></h4>
            <li>
                <a href="https://bluevia.com/en/page/biz.businessmodels">Business Models</a>
            </li>
            <li>
                <a href="https://bluevia.com/en/page/biz.digitalgoods">Selling Digital Goods</a>
            </li>
            <li>
                <a href="https://bluevia.com/en/page/biz.getpaid">Get Paid</a>
            </li>
            <li>
                <a href="https://bluevia.com/en/page/biz.marketingstuff">Marketing Stuff</a>
            </li>
            <li>
                <a href="https://bluevia.com/en/page/biz.wayra">Wayra</a>
            </li>
        </ul>
<ul class="footer_nav span2 unstyled">
<h4><a href="https://bluevia.com/en/page/inspiration">Inspiration</a></h4>
            <li>
                <a id="menu-case" href="https://bluevia.com/en/page/inspiration.appiversary">Appiversary</a>
            </li>
            <li>
                <a id="menu-case" href="https://bluevia.com/en/page/inspiration.facejam">FaceJam</a>
            </li>
            <li>
                <a id="menu-case" href="https://bluevia.com/en/page/inspiration.facetones">Facetones</a>
            </li>
            <li>
                <a id="menu-case" href="https://bluevia.com/en/page/inspiration.textdeck">Textdeck</a>
            </li>
            <li>
                <a id="menu-case" href="https://bluevia.com/en/page/inspiration">More...</a>
            </li>
        </ul>
<ul class="footer_nav span2 unstyled">
<h4>Support</h4>
          <li>
            <a href="https://bluevia.com/en/page/support">contact us</a>
          </li>
        </ul>
</div>
    </div>
    <div class="row-fluid">

    </div>
    <!-- /.site --> </div>
  <!-- /#footer -->
</div>
<script>

  $(".apidoc li > dl > dt").addClass("span3");
  $(".apidoc dl dl dt").addClass("span4");
  $(".apimethod dt").addClass("span2");
  $(".apimethod dd").addClass("offset1");

  // Highlighting current page in the sidebar menu
  pathname = window.location.pathname;
  $("a[href='"+pathname+"']").parent().addClass("active");
  $("a[href='"+pathname+"']").parents(".collapse").collapse("show");

  pathtitle = $("#sidebar a[href='./']")[0];


  // Previous and next links
  menuLinks = $("#sidebar a").not(".accordion-toggle");
  pageIndex = $(menuLinks).index($(pathtitle));
  prevPage = $($(menuLinks)[pageIndex - 1]).clone();
  nextPage = $($(menuLinks)[pageIndex + 1]).clone();
  $(prevPage).prepend("<< ");
  $(nextPage).append(" >>");

  $("#prevPage").html($(prevPage));
  $("#nextPage").html($(nextPage));

  // Breadcrumbs
  parentGroup = $(pathtitle).parents(".accordion-group");
  parentCategoryText = $(".accordion-heading a:last",parentGroup)[0];
  if(parentCategoryText != null) {
    if($(parentCategoryText).text() != $(pathtitle).text())
      $(".breadcrumb li.active").before('<li><a href="'+$(parentCategoryText).attr("href")+'">'+$(parentCategoryText).text()+'</a> <span class="divider">/</span></li>');
  }
  if (pathtitle != null)
    $(".breadcrumb .active").text(pathtitle.text);

</script>
</body>
</html>
